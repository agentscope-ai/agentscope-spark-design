"use strict";(self.webpackChunk_agentscope_ai_chat=self.webpackChunk_agentscope_ai_chat||[]).push([[6271],{45554:function(i,a,n){n.r(a);var r=n(76311),c=n(93359),l=n(93612),p=n(57415),h=n(63032),t=n(10294),m=n(96057),g=n(76387),x=n(58041),f=n(19482),k=n(36711),v=n(12068),I=n(33456),o=n(58542),d=n(48936),_=n(67294),s=n(36840),e=n(85893);function u(){return(0,e.jsx)(o.dY,{children:(0,e.jsx)(_.Suspense,{fallback:(0,e.jsx)(d.Z,{}),children:(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{className:"markdown",children:[(0,e.jsxs)("h1",{id:"\u901A\u4E49\u5343\u95EE",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#\u901A\u4E49\u5343\u95EE",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"\u901A\u4E49\u5343\u95EE"]}),(0,e.jsxs)("p",{children:[s.texts[0].value,(0,e.jsx)("a",{href:"https://help.aliyun.com/zh/model-studio/developer-reference/compatibility-of-openai-with-dashscope",children:s.texts[1].value})]}),(0,e.jsxs)("h2",{id:"\u76F8\u5173\u53C2\u6570\u83B7\u53D6",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#\u76F8\u5173\u53C2\u6570\u83B7\u53D6",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"\u76F8\u5173\u53C2\u6570\u83B7\u53D6"]}),(0,e.jsxs)("ul",{children:[(0,e.jsxs)("li",{children:[s.texts[2].value,(0,e.jsx)("a",{href:"https://help.aliyun.com/zh/model-studio/getting-started/what-is-model-studio",children:s.texts[3].value})]}),(0,e.jsxs)("li",{children:[s.texts[4].value,(0,e.jsx)("a",{href:"https://help.aliyun.com/zh/model-studio/developer-reference/get-api-key",children:s.texts[5].value})]}),(0,e.jsxs)("li",{children:[s.texts[6].value,(0,e.jsx)("a",{href:"https://help.aliyun.com/zh/model-studio/getting-started/models",children:s.texts[7].value})]})]}),(0,e.jsxs)("h2",{id:"\u517C\u5BB9-openai-\u6A21\u5F0F",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#\u517C\u5BB9-openai-\u6A21\u5F0F",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"\u517C\u5BB9 OpenAI \u6A21\u5F0F"]}),(0,e.jsx)("p",{children:s.texts[8].value}),(0,e.jsxs)("h2",{id:"\u4F7F\u7528-openai-node-\u63A5\u5165",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#\u4F7F\u7528-openai-node-\u63A5\u5165",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"\u4F7F\u7528 ",(0,e.jsx)("a",{href:"https://github.com/openai/openai-node",children:s.texts[9].value})," \u63A5\u5165"]}),(0,e.jsxs)("h3",{id:"\u5B89\u88C5\u4F9D\u8D56",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#\u5B89\u88C5\u4F9D\u8D56",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"\u5B89\u88C5\u4F9D\u8D56"]}),(0,e.jsx)(t.Z,{lang:"bash",children:s.texts[10].value}),(0,e.jsxs)("h3",{id:"\u8C03\u7528\u793A\u4F8B",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#\u8C03\u7528\u793A\u4F8B",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"\u8C03\u7528\u793A\u4F8B"]}),(0,e.jsx)(t.Z,{lang:"tsx",children:s.texts[11].value}),(0,e.jsx)("img",{src:"https://gw.alicdn.com/imgextra/i3/O1CN0180qH4s1WvoGlqDdbx_!!6000000002851-2-tps-2452-1654.png",style:{maxWidth:"50%"},alt:"Qwen \u96C6\u6210\u793A\u4F8B"}),(0,e.jsx)("hr",{}),(0,e.jsxs)("h2",{id:"\u4F7F\u7528-api-\u63A5\u5165",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#\u4F7F\u7528-api-\u63A5\u5165",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"\u4F7F\u7528 API \u63A5\u5165"]}),(0,e.jsx)(t.Z,{lang:"tsx",children:s.texts[12].value}),(0,e.jsxs)("h2",{id:"dangerouslyallowbrowser",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#dangerouslyallowbrowser",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"dangerouslyAllowBrowser"]}),(0,e.jsxs)("p",{children:[s.texts[13].value,(0,e.jsx)("code",{children:s.texts[14].value}),s.texts[15].value]}),(0,e.jsx)("p",{children:s.texts[16].value})]})})})})}a.default=u},36840:function(i,a,n){n.r(a),n.d(a,{texts:function(){return r}});const r=[{value:"Qwen \u7684\u6A21\u578B\u63A8\u7406\u670D\u52A1\u652F\u6301\u300C\u517C\u5BB9 OpenAI \u6A21\u5F0F\u300D\u3002\u8BE6\u89C1\u5B98\u65B9\u6587\u6863: ",paraId:0,tocIndex:0},{value:"\u963F\u91CC\u4E91\u767E\u70BC - \u901A\u4E49\u5343\u95EE",paraId:0,tocIndex:0},{value:"\u5982\u4F55\u83B7\u53D6 baseURL - ",paraId:1,tocIndex:1},{value:"https://help.aliyun.com/zh/model-studio/getting-started/what-is-model-studio",paraId:1,tocIndex:1},{value:"\u5982\u4F55\u83B7\u53D6 API Key - ",paraId:1,tocIndex:1},{value:"https://help.aliyun.com/zh/model-studio/developer-reference/get-api-key",paraId:1,tocIndex:1},{value:"\u6A21\u578B\u5217\u8868 - ",paraId:1,tocIndex:1},{value:"https://help.aliyun.com/zh/model-studio/getting-started/models",paraId:1,tocIndex:1},{value:"\u662F\u6307\u5728\u63A5\u53E3\u8BBE\u8BA1\u548C\u4F7F\u7528\u65B9\u5F0F\u4E0A\u4E0E OpenAI \u7684 API \u4FDD\u6301\u4E00\u81F4\u7684\u6A21\u578B\u63A8\u7406\u670D\u52A1\u3002\u8FD9\u610F\u5473\u7740\u5F00\u53D1\u8005\u53EF\u4EE5\u4F7F\u7528\u4E0E\u8C03\u7528 OpenAI \u6A21\u578B\u76F8\u540C\u7684\u4EE3\u7801\u548C\u65B9\u6CD5\uFF0C\u6765\u8C03\u7528\u8FD9\u4E9B\u517C\u5BB9\u670D\u52A1\uFF0C\u4ECE\u800C\u51CF\u5C11\u5F00\u53D1\u63A5\u5165\u6210\u672C\u3002",paraId:2,tocIndex:2},{value:"openai-node",paraId:3},{value:`$ npm install openai-node --save
`,paraId:4,tocIndex:4},{value:`import { ConfigProvider, carbonTheme } from '@agentscope-ai/design';
import { Bubble, ChatInput, type TMessage } from '@agentscope-ai/chat';
import { useRef, useState } from 'react';
import OpenAI from 'openai';
import { produce } from 'immer';
import { ChatCompletionMessageParam } from 'openai/resources.mjs';

const client = new OpenAI({
  baseURL: 'https://dashscope.aliyuncs.com/compatible-mode/v1',
  apiKey: 'sk-xxxx', // \u8BF7\u66FF\u6362\u6210\u4F60\u7684 API Key
  dangerouslyAllowBrowser: true, // \u5141\u8BB8\u5728\u6D4F\u89C8\u5668\u4E2D\u8FD0\u884C
});

function Sender({
  handleSend,
  loading,
}: {
  handleSend: (input: string) => void;
  loading: boolean;
}) {
  const [input, setInput] = useState('');

  return (
    <ChatInput
      value={input}
      onChange={setInput}
      onSubmit={(input) => {
        handleSend(input);
        setInput('');
      }}
      loading={loading}
    />
  );
}

function App() {
  const [messages, setMessages] = useState<TMessage[]>([]);
  const [loading, setLoading] = useState(false);

  const currentAnswer = useRef<TMessage | null>(null);

  const handleSend = async (input: string) => {
    const id = 'a' + Date.now().toString();
    const query = {
      role: 'user',
      content: input,
      id: 'q' + Date.now().toString(),
    } as TMessage;

    currentAnswer.current = {
      role: 'assistant',
      content: '',
      msgStatus: 'generating',
      id,
    };

    setMessages((v) => [...v, query, currentAnswer.current as TMessage]);
    setLoading(true);

    const stream = await client.chat.completions.create({
      model: 'qwen-plus',
      messages: [...messages, query] as ChatCompletionMessageParam[],
      stream: true,
    });

    for await (const chunk of stream) {
      currentAnswer.current = produce(currentAnswer.current, (draft) => {
        if (chunk.choices[0]?.finish_reason === 'stop') {
          draft.msgStatus = 'finished';
        }
        draft.content += chunk.choices[0]?.delta?.content || '';
      });
      setMessages((v) =>
        v.map((item) =>
          item.id === currentAnswer.current?.id ? currentAnswer.current : item,
        ),
      );
    }

    setLoading(false);
  };

  return (
    <ConfigProvider {...carbonTheme} prefix="spark-chat" prefixCls="spark-chat">
      <div className="h-[80vh] m-[20px] flex flex-col">
        <Bubble.List
          items={messages}
          classNames={{
            wrapper: 'flex-1 h-[0]',
          }}
        />
        <Sender handleSend={handleSend} loading={loading} />
      </div>
    </ConfigProvider>
  );
}

export default App;
`,paraId:5,tocIndex:5},{value:`import { ConfigProvider, carbonTheme } from '@agentscope-ai/design';
import {
  Bubble,
  ChatInput,
  Stream,
  type TMessage,
} from '@agentscope-ai/chat';
import { useRef, useState } from 'react';
import { produce } from 'immer';

function Sender({
  handleSend,
  loading,
}: {
  handleSend: (input: string) => void;
  loading: boolean;
}) {
  const [input, setInput] = useState('');

  return (
    <ChatInput
      value={input}
      onChange={setInput}
      onSubmit={(input) => {
        handleSend(input);
        setInput('');
      }}
      loading={loading}
    />
  );
}

function App() {
  const [messages, setMessages] = useState<TMessage[]>([]);
  const [loading, setLoading] = useState(false);

  const currentAnswer = useRef<TMessage | null>(null);

  const handleSend = async (input: string) => {
    const id = 'a' + Date.now().toString();
    const query = {
      role: 'user',
      content: input,
      id: 'q' + Date.now().toString(),
    } as TMessage;

    currentAnswer.current = {
      role: 'assistant',
      content: '',
      msgStatus: 'generating',
      id,
    };

    setMessages((v) => [...v, query, currentAnswer.current as TMessage]);
    setLoading(true);

    const response = await fetch(
      'https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions',
      {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          Authorization: \`Bearer sk-xxxx\`,
        },
        body: JSON.stringify({
          model: 'qwen-plus',
          messages: [...messages, query],
          stream: true,
        }),
      },
    );

    if (response.body) {
      for await (const chunk of Stream(
        {
          readableStream: response.body,
        },
        {
          openaiCompatible: true,
        },
      )) {
        if (chunk.data === '[DONE]') {
          break;
        }
        const data = JSON.parse(chunk.data);
        currentAnswer.current = produce(currentAnswer.current, (draft) => {
          if (data.choices[0]?.finish_reason === 'stop') {
            draft.msgStatus = 'finished';
          }
          draft.content += data.choices[0]?.delta?.content || '';
        });
        setMessages((v) =>
          v.map((item) =>
            item.id === currentAnswer.current?.id
              ? currentAnswer.current
              : item,
          ),
        );
      }
    }
    setLoading(false);
  };

  return (
    <ConfigProvider {...carbonTheme} prefix="spark-chat" prefixCls="spark-chat">
      <div className="h-[80vh] m-[20px] flex flex-col">
        <Bubble.List
          items={messages}
          classNames={{
            wrapper: 'flex-1 h-[0]',
          }}
        />
        <Sender handleSend={handleSend} loading={loading} />
      </div>
    </ConfigProvider>
  );
}

export default App;
`,paraId:6,tocIndex:6},{value:"\u542F\u7528\u6B64",paraId:7,tocIndex:7},{value:"dangerouslyApiKey",paraId:7,tocIndex:7},{value:"\u9009\u9879\u53EF\u80FD\u4F1A\u5F88\u5371\u9669\uFF0C\u56E0\u4E3A\u5B83\u4F1A\u5728\u5BA2\u6237\u7AEF\u4EE3\u7801\u4E2D\u66B4\u9732\u60A8\u7684\u79D8\u5BC6 API \u51ED\u636E\u3002Web \u6D4F\u89C8\u5668\u672C\u8D28\u4E0A\u4E0D\u5982\u670D\u52A1\u5668\u73AF\u5883\u5B89\u5168\uFF0C\u4EFB\u4F55\u6709\u6743\u8BBF\u95EE\u6D4F\u89C8\u5668\u7684\u7528\u6237\u90FD\u53EF\u80FD\u68C0\u67E5\u3001\u63D0\u53D6\u548C\u6EE5\u7528\u8FD9\u4E9B\u51ED\u636E\u3002\u8FD9\u53EF\u80FD\u4F1A\u5BFC\u81F4\u4F7F\u7528\u60A8\u7684\u51ED\u636E\u8FDB\u884C\u672A\u7ECF\u6388\u6743\u7684\u8BBF\u95EE\uFF0C\u5E76\u53EF\u80FD\u5371\u53CA\u654F\u611F\u6570\u636E\u6216\u529F\u80FD\u3002\u4EE5\u4E0A\u4EE3\u7801\u4E3B\u8981\u662F\u793A\u4F8B\u4EE3\u7801\uFF0C\u5B9E\u9645\u5F00\u53D1\u4E2D\u8BF7\u4E0D\u8981\u4F7F\u7528\u3002",paraId:7,tocIndex:7},{value:"\u66F4\u6B63\u786E\u7684\u505A\u6CD5\u662F\u8C03\u7528\u5927\u6A21\u578B\u7684\u4EE3\u7801\u5728\u540E\u7AEF\uFF08\u542B apiKey \u7684\u914D\u7F6E\uFF09\u3002",paraId:8,tocIndex:7}]}}]);
