"use strict";(self.webpackChunk_agentscope_ai_chat=self.webpackChunk_agentscope_ai_chat||[]).push([[9842],{63339:function(p,s,e){e.r(s);var d=e(76311),l=e(93359),u=e(93612),a=e(57415),g=e(63032),i=e(10294),r=e(96057),c=e(76387),o=e(58041),m=e(19482),_=e(36711),h=e(12068),I=e(33456),M=e(50),x=e(58542),f=e(48936),v=e(67294),t=e(1946),n=e(85893);function k(){return(0,n.jsx)(x.dY,{children:(0,n.jsx)(v.Suspense,{fallback:(0,n.jsx)(f.Z,{}),children:(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:"markdown",children:[(0,n.jsxs)("h1",{id:"bailian",children:[(0,n.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#bailian",children:(0,n.jsx)("span",{className:"icon icon-link"})}),"Bailian"]}),(0,n.jsx)("p",{children:t.texts[0].value}),(0,n.jsxs)("h2",{id:"prerequisites",children:[(0,n.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#prerequisites",children:(0,n.jsx)("span",{className:"icon icon-link"})}),"Prerequisites"]}),(0,n.jsxs)("ul",{children:[(0,n.jsxs)("li",{children:[t.texts[1].value,(0,n.jsx)("a",{href:"https://help.aliyun.com/zh/model-studio/getting-started/what-is-model-studio",children:t.texts[2].value})]}),(0,n.jsxs)("li",{children:[t.texts[3].value,(0,n.jsx)("a",{href:"https://help.aliyun.com/zh/model-studio/developer-reference/get-api-key",children:t.texts[4].value})]}),(0,n.jsxs)("li",{children:[t.texts[5].value,(0,n.jsxs)("ul",{children:[(0,n.jsx)("li",{children:(0,n.jsx)("a",{href:"https://help.aliyun.com/zh/model-studio/single-agent-application",children:t.texts[6].value})}),(0,n.jsx)("li",{children:(0,n.jsx)("a",{href:"https://bailian.console.aliyun.com/?tab=app#/app-center",children:t.texts[7].value})})]})]})]}),(0,n.jsxs)("h2",{id:"workflow-invocation",children:[(0,n.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#workflow-invocation",children:(0,n.jsx)("span",{className:"icon icon-link"})}),"Workflow Invocation"]}),(0,n.jsxs)("h3",{id:"workflow-setup",children:[(0,n.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#workflow-setup",children:(0,n.jsx)("span",{className:"icon icon-link"})}),"Workflow Setup"]}),(0,n.jsx)("blockquote",{children:(0,n.jsx)("p",{children:t.texts[8].value})}),(0,n.jsx)("img",{src:"https://gw.alicdn.com/imgextra/i1/O1CN01djpE1e280W7hW930J_!!6000000007870-2-tps-2452-1654.png",width:"50%"}),(0,n.jsxs)("h3",{id:"code-implementation",children:[(0,n.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#code-implementation",children:(0,n.jsx)("span",{className:"icon icon-link"})}),"Code Implementation"]}),(0,n.jsx)("blockquote",{children:(0,n.jsx)("p",{children:t.texts[9].value})}),(0,n.jsx)("img",{src:"https://gw.alicdn.com/imgextra/i1/O1CN01n0tmbe1kYp0hcR83z_!!6000000004696-1-tps-1068-720.gif",width:"50%"}),(0,n.jsx)(i.Z,{lang:"tsx",children:t.texts[10].value}),(0,n.jsxs)("h2",{id:"agent-invocation",children:[(0,n.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#agent-invocation",children:(0,n.jsx)("span",{className:"icon icon-link"})}),"Agent Invocation"]}),(0,n.jsxs)("h3",{id:"agent-setup",children:[(0,n.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#agent-setup",children:(0,n.jsx)("span",{className:"icon icon-link"})}),"Agent Setup"]}),(0,n.jsx)("blockquote",{children:(0,n.jsx)("p",{children:t.texts[11].value})}),(0,n.jsx)("img",{src:"https://gw.alicdn.com/imgextra/i2/O1CN01oduDVS1cOjMACqWMp_!!6000000003591-2-tps-2452-1654.png",width:"50%"}),(0,n.jsxs)("h3",{id:"code-implementation-1",children:[(0,n.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#code-implementation-1",children:(0,n.jsx)("span",{className:"icon icon-link"})}),"Code Implementation"]}),(0,n.jsx)(i.Z,{lang:"tsx",children:t.texts[12].value}),(0,n.jsx)("img",{src:"https://gw.alicdn.com/imgextra/i2/O1CN01tAh5r71D07gMq9kfP_!!6000000000153-2-tps-2452-1654.png",width:"50%"})]})})})})}s.default=k},50:function(p,s,e){var d=e(58542),l=e(2487),u=e(9053),a=e(85893),g=(0,u.kc)(function(i){var r=i.token;return{list:{display:"flex",gap:r.marginMD},title:{color:r.colorText,transition:"color 0.3s ease","&:hover":{color:r.colorTextSecondary,textDecoration:"underline"}}}});s.Z=function(){var i=(0,d.tx)(),r=g(),c=r.styles;return(0,a.jsx)("div",{className:c.list,children:i.filter(function(o){return o.title}).map(function(o){return(0,a.jsx)(l.Z,{style:{flex:1},header:(0,a.jsx)("h3",{children:o.title}),itemLayout:"horizontal",dataSource:o.children,renderItem:function(_,h){return(0,a.jsx)(l.Z.Item,{children:(0,a.jsx)(d.rU,{to:_.link,style:{display:"block",width:"100%"},children:(0,a.jsx)(l.Z.Item.Meta,{title:(0,a.jsx)("div",{className:c.title,children:_.title}),description:_.frontmatter.description})})},h)}},o.title)})})}},1946:function(p,s,e){e.r(s),e.d(s,{texts:function(){return d}});const d=[{value:"This guide will introduce how to integrate intelligent agents built on Alibaba Cloud Cloud Bailian with Alibaba Cloud Spark Chat.",paraId:0,tocIndex:0},{value:"How to get baseURL - ",paraId:1,tocIndex:1},{value:"https://help.aliyun.com/zh/model-studio/getting-started/what-is-model-studio",paraId:1,tocIndex:1},{value:"How to get API Key - ",paraId:1,tocIndex:1},{value:"https://help.aliyun.com/zh/model-studio/developer-reference/get-api-key",paraId:1,tocIndex:1},{value:`Created intelligent agent application and obtained APP_ID (Alibaba Cloud Cloud Bailian application ID): Get it from the application card on the application management page.
`,paraId:1,tocIndex:1},{value:"https://help.aliyun.com/zh/model-studio/single-agent-application",paraId:2,tocIndex:1},{value:"https://bailian.console.aliyun.com/?tab=app#/app-center",paraId:2,tocIndex:1},{value:"The demo is relatively simple, but in practice you can enable various features like RAG, MCP, loop calls, etc.",paraId:3,tocIndex:3},{value:"The demo uses custom cards to implement a form for collecting user input parameters and executing the workflow",paraId:4,tocIndex:4},{value:`import {
  ConfigProvider,
  carbonTheme,
  Card,
  Input,
  Select,
  Button,
} from '@agentscope-ai/design';
import {
  Bubble,
  ChatInput,
  Stream,
  type TMessage,
  CustomCardsProvider,
} from '@agentscope-ai/chat';
import { useRef, useState } from 'react';
import { produce } from 'immer';
import './App.css';
import { Flex, Space } from 'antd';
import React from 'react';

const MessagesContext = React.createContext<{
  messages: TMessage[];
  setMessages: React.Dispatch<React.SetStateAction<TMessage[]>>;
  loading?: boolean;
  setLoading: React.Dispatch<React.SetStateAction<boolean>>;
}>({
  messages: [],
  setMessages: () => {},
  setLoading: () => {},
  loading: false,
});

function Sender({
  handleSend,
  loading,
}: {
  handleSend: (input: string) => void;
  loading: boolean;
}) {
  const [input, setInput] = useState('');

  return (
    <ChatInput
      value={input}
      onChange={setInput}
      onSubmit={(input) => {
        handleSend(input);
        setInput('');
      }}
      loading={loading}
    />
  );
}

function TranslateStart() {
  const { setMessages, loading, setLoading } =
    React.useContext(MessagesContext);
  const [originText, setOriginText] = useState('');
  const [targetLang, setTargetLang] = useState('English');
  const currentAnswer = useRef<TMessage | null>(null);
  const [disabled, setDisabled] = useState(false);

  return (
    <Card title="Translate Start">
      <Space direction="vertical" size={8}>
        <Flex align="center">
          <label className="w-[80px] flex-none">originText</label>
          <Input
            placeholder="Please enter content to translate"
            value={originText}
            onChange={(e) => setOriginText(e.target.value)}
          />
        </Flex>
        <Flex align="center">
          <label className="w-[80px] flex-none">targetLang</label>
          <Select
            placeholder="Please select target language"
            value={targetLang}
            onChange={(value) => setTargetLang(value)}
            options={[
              { label: 'English', value: 'English' },
              { label: 'Japanese', value: 'Japanese' },
              { label: 'French', value: 'French' },
            ]}
          />
        </Flex>

        <Button
          type="primary"
          disabled={disabled}
          loading={!disabled && loading}
          onClick={async () => {
            setLoading(true);
            const id = 'a' + Date.now().toString();

            currentAnswer.current = {
              role: 'assistant',
              content: '',
              msgStatus: 'generating',
              id,
            };

            setMessages((v) => [...v, currentAnswer.current as TMessage]);

            const response = await fetch(
              \`https://dashscope.aliyuncs.com/api/v1/apps/YOUR_APP_ID/completion\`,
              {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json',
                  Authorization: \`Bearer sk-xxxx\`,
                  'X-DashScope-SSE': 'enable',
                },
                body: JSON.stringify({
                  session_id: Date.now().toString(),
                  input: {
                    prompt: 'Start translation',
                    biz_params: {
                      originText: originText,
                      targetLang: targetLang,
                    },
                  },
                  parameters: {
                    incremental_output: false,
                  },
                }),
              },
            );

            if (response.body) {
              for await (const chunk of Stream(
                {
                  readableStream: response.body,
                },
                {},
              )) {
                const data = JSON.parse(chunk.data);

                currentAnswer.current = produce(
                  currentAnswer.current,
                  (draft) => {
                    if (data.output?.finish_reason === 'stop') {
                      draft.msgStatus = 'finished';
                    }
                    draft.content = data.output?.text || '';
                  },
                );
                setMessages((v) =>
                  v.map((item) =>
                    item.id === currentAnswer.current?.id
                      ? currentAnswer.current
                      : item,
                  ),
                );
              }
            }

            setLoading(false);
            setDisabled(true);
          }}
        >
          Translate
        </Button>
      </Space>
    </Card>
  );
}

function App() {
  const [messages, setMessages] = useState<TMessage[]>([]);
  const [loading, setLoading] = useState(false);

  const handleSend = async (input: string) => {
    const query = {
      role: 'user',
      content: input,
      id: 'q' + Date.now().toString(),
    } as TMessage;

    setMessages((v) => [...v, query]);
  };

  return (
    <ConfigProvider {...carbonTheme} prefix="spark-chat" prefixCls="spark-chat">
      <CustomCardsProvider
        cardConfig={{
          TranslateStart,
        }}
      >
        <MessagesContext.Provider
          value={{ messages, setMessages, loading, setLoading }}
        >
          <div className="h-[100vh] p-[20px] flex flex-col">
            <Bubble.List
              items={messages}
              classNames={{
                wrapper: 'flex-1 h-[0]',
              }}
            />
            <div className="mb-[8px]">
              <Button
                onClick={() => {
                  setMessages((v) => [
                    ...v,
                    {
                      role: 'assistant',
                      cards: [{ code: 'TranslateStart' }],
                      id: 'q' + Date.now().toString(),
                    },
                  ]);
                }}
              >
                Translation Mode
              </Button>
            </div>
            <Sender handleSend={handleSend} loading={loading} />
          </div>
        </MessagesContext.Provider>
      </CustomCardsProvider>
    </ConfigProvider>
  );
}

export default App;
`,paraId:5,tocIndex:4},{value:"The demo is relatively simple, but in practice you can enable various features like RAG, MCP, etc.",paraId:6,tocIndex:6},{value:`import { ConfigProvider, carbonTheme } from '@agentscope-ai/design';
import { Bubble, ChatInput, Stream, type TMessage } from '@agentscope-ai/chat';
import { useRef, useState } from 'react';
import { produce } from 'immer';
import './App.css';

function Sender({
  handleSend,
  loading,
}: {
  handleSend: (input: string) => void;
  loading: boolean;
}) {
  const [input, setInput] = useState('');

  return (
    <ChatInput
      value={input}
      onChange={setInput}
      onSubmit={(input) => {
        handleSend(input);
        setInput('');
      }}
      loading={loading}
    />
  );
}

function App() {
  const [messages, setMessages] = useState<TMessage[]>([]);
  const [loading, setLoading] = useState(false);
  const sessionIdRef = useRef<string>(Date.now().toString());
  const currentAnswer = useRef<TMessage | null>(null);

  const handleSend = async (input: string) => {
    const query = {
      role: 'user',
      content: input,
      id: 'q' + Date.now().toString(),
    } as TMessage;

    const id = 'a' + Date.now().toString();

    currentAnswer.current = {
      role: 'assistant',
      content: '',
      msgStatus: 'generating',
      id,
    };

    setMessages((v) => [...v, query, currentAnswer.current as TMessage]);
    setLoading(true);

    const response = await fetch(
      \`https://dashscope.aliyuncs.com/api/v1/apps/YOUR_APP_ID/completion\`,
      {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          Authorization: \`Bearer sk-xxxx\`,
          'X-DashScope-SSE': 'enable',
        },
        body: JSON.stringify({
          session_id: sessionIdRef.current,
          input: {
            prompt: 'Recommend some food',
            biz_params: {
              user_prompt_params: {
                city: input,
              },
            },
          },
          parameters: {
            incremental_output: false,
          },
        }),
      },
    );

    if (response.body) {
      for await (const chunk of Stream(
        {
          readableStream: response.body,
        },
        {},
      )) {
        const data = JSON.parse(chunk.data);
        currentAnswer.current = produce(currentAnswer.current, (draft) => {
          if (data.output?.finish_reason === 'stop') {
            draft.msgStatus = 'finished';
          }
          draft.content = data.output?.text || '';
        });
        setMessages((v) =>
          v.map((item) =>
            item.id === currentAnswer.current?.id
              ? currentAnswer.current
              : item,
          ),
        );
      }
    }

    setLoading(false);
  };

  return (
    <ConfigProvider {...carbonTheme} prefix="spark-chat" prefixCls="spark-chat">
      <div className="h-[100vh] p-[20px] flex flex-col">
        <Bubble.List
          items={messages}
          classNames={{
            wrapper: 'flex-1 h-[0]',
          }}
        />
        <Sender handleSend={handleSend} loading={loading} />
      </div>
    </ConfigProvider>
  );
}

export default App;
`,paraId:7,tocIndex:7}]}}]);
